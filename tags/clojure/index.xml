<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>clojure on (-> c r u d)</title><link>https://youkale.github.io/tags/clojure/</link><description>Recent content in clojure on (-> c r u d)</description><generator>Hugo -- gohugo.io</generator><language>zh</language><lastBuildDate>Thu, 21 Oct 2021 12:32:29 +0800</lastBuildDate><atom:link href="https://youkale.github.io/tags/clojure/index.xml" rel="self" type="application/rss+xml"/><item><title>clojure支持参数重载的宏</title><link>https://youkale.github.io/posts/make-clojure-overload-definline/</link><pubDate>Thu, 21 Oct 2021 12:32:29 +0800</pubDate><guid>https://youkale.github.io/posts/make-clojure-overload-definline/</guid><description> 问题 通过clojure.core/definline可以以方法的形态定义一个宏，但是definline这个宏却只支持固定的参数，在某些情况下需要支持不同参数的宏，从java的角度来说就是方法重载了。
支持重载的definline 大部分代码都是在definline的基础上魔改的。
(defmacro definline+ [name &amp;amp; decl] (let [body (map (fn [[args# expr#]] (let [f# (apply (eval (list `fn (list args# expr#))) args#)] `(~args# ~f#))) decl) alt-body (map (fn [[args# expr#]] `(~args# ~expr#)) decl)] `(do (defn ~name ~@body) (alter-meta! (var ~name) assoc :inline (fn ~name ~@alt-body)) (var ~name))))])))])) 使用 比如noop 方法，现在可以支持2、3个参数了。
(definline+ noop ([a b] (or ~a ~b)) ([a b c] (or ~a ~b ~c)))</description></item><item><title>clojure.xml忽略DTD验证</title><link>https://youkale.github.io/posts/clojure.xml%E5%BF%BD%E7%95%A5dtd%E9%AA%8C%E8%AF%81/</link><pubDate>Sun, 21 May 2017 12:32:29 +0800</pubDate><guid>https://youkale.github.io/posts/clojure.xml%E5%BF%BD%E7%95%A5dtd%E9%AA%8C%E8%AF%81/</guid><description>问题 在通过clojure生成mybatis mapper文件的过程中，发现启动过程缓慢，原因是会验证xml的schema，因此解决方法就是屏蔽掉DTD的验证
clojure.xml API没有DTD写入解决: (defn emit-xml &amp;#34;Prints the given Element tree as XML text to stream. Options: :encoding &amp;lt;str&amp;gt; Character encoding to use&amp;#34; [e &amp;amp; {:as opts}] (let [stream (StringWriter.) ^XMLStreamWriter writer (-&amp;gt; (XMLOutputFactory/newInstance) (.createXMLStreamWriter stream))] (when (instance? OutputStreamWriter stream) (check-stream-encoding stream (or (:encoding opts) &amp;#34;UTF-8&amp;#34;))) (.writeStartDocument writer (or (:encoding opts) &amp;#34;UTF-8&amp;#34;) &amp;#34;1.0&amp;#34;) (.writeDTD writer &amp;#34;&amp;lt;!DOCTYPE mapper PUBLIC \&amp;#34;-//mybatis.org//DTD Mapper 3.0//EN\&amp;#34; \&amp;#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd\&amp;#34;&amp;gt;&amp;#34;) (doseq [event (flatten-elements [e])] (emit-event event writer)) (.</description></item></channel></rss>