<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Youkale"><meta name=description content="ngrok 是用go语言实现的，编译过程碰到不少坑 主要碰到的坑就是依赖错误，以及依赖的包被伟大的GFW给挡住了。 最好是用天朝外的VPS make release-server release-client
修改日志src/ngrok/log/logger.go中的import部分改成
import ( log &#34;github.com/alecthomas/log4go&#34; &#34;fmt&#34; ) 其他的跟网上的差不多了。 下面就把依赖好的包打包发上来，以及编译的方法给大家说下： 这个包是已经包含好了依赖，拿到包后，确认你的环境，如果你要编译客户端需要go 1.6 否则编译会通不过
安装依赖 sudo apt-get install build-essential golang mercurial git 解压 tar -zxv -f ngrok.pkg.tar.gz 生成证书 openssl genrsa -out base.key 2048 openssl req -new -x509 -nodes -key base.key -days 10000 -subj &#34;/CN=ngrok.youkele.com&#34; -out base.pem openssl genrsa -out server.key 2048 openssl req -new -key server.key -subj &#34;/CN=ngrok.youkele.com&#34; -out server.csr openssl x509 -req -in server."><meta name=keywords content="rest,kafka,clojure,golang,redis,程序员,developer,数据集成,pipeline,rule engine"><meta name=twitter:card content="summary"><meta name=twitter:title content="Ngrok 编译的坑"><meta name=twitter:description content="ngrok 是用go语言实现的，编译过程碰到不少坑 主要碰到的坑就是依赖错误，以及依赖的包被伟大的GFW给挡住了。 最好是用天朝外的VPS make release-server release-client
修改日志src/ngrok/log/logger.go中的import部分改成
import ( log &#34;github.com/alecthomas/log4go&#34; &#34;fmt&#34; ) 其他的跟网上的差不多了。 下面就把依赖好的包打包发上来，以及编译的方法给大家说下： 这个包是已经包含好了依赖，拿到包后，确认你的环境，如果你要编译客户端需要go 1.6 否则编译会通不过
安装依赖 sudo apt-get install build-essential golang mercurial git 解压 tar -zxv -f ngrok.pkg.tar.gz 生成证书 openssl genrsa -out base.key 2048 openssl req -new -x509 -nodes -key base.key -days 10000 -subj &#34;/CN=ngrok.youkele.com&#34; -out base.pem openssl genrsa -out server.key 2048 openssl req -new -key server.key -subj &#34;/CN=ngrok.youkele.com&#34; -out server.csr openssl x509 -req -in server."><meta property="og:title" content="Ngrok 编译的坑"><meta property="og:description" content="ngrok 是用go语言实现的，编译过程碰到不少坑 主要碰到的坑就是依赖错误，以及依赖的包被伟大的GFW给挡住了。 最好是用天朝外的VPS make release-server release-client
修改日志src/ngrok/log/logger.go中的import部分改成
import ( log &#34;github.com/alecthomas/log4go&#34; &#34;fmt&#34; ) 其他的跟网上的差不多了。 下面就把依赖好的包打包发上来，以及编译的方法给大家说下： 这个包是已经包含好了依赖，拿到包后，确认你的环境，如果你要编译客户端需要go 1.6 否则编译会通不过
安装依赖 sudo apt-get install build-essential golang mercurial git 解压 tar -zxv -f ngrok.pkg.tar.gz 生成证书 openssl genrsa -out base.key 2048 openssl req -new -x509 -nodes -key base.key -days 10000 -subj &#34;/CN=ngrok.youkele.com&#34; -out base.pem openssl genrsa -out server.key 2048 openssl req -new -key server.key -subj &#34;/CN=ngrok.youkele.com&#34; -out server.csr openssl x509 -req -in server."><meta property="og:type" content="article"><meta property="og:url" content="https://youkale.github.io/posts/ngrok-compile-problem/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-06-01T17:57:00+00:00"><meta property="article:modified_time" content="2016-06-01T17:57:00+00:00"><title>(-> c r u d)</title><link rel=canonical href=https://youkale.github.io/posts/ngrok-compile-problem/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.6b1a4fbc48955b72aea7913e43fabeb45e8bc120da5aa41b598dd33adcac4b59.css integrity="sha256-axpPvEiVW3Kup5E+Q/q+tF6LwSDaWqQbWY3TOtysS1k=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.100.1"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>(-> c r u d)</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/bookmark/>收藏</a></li><li class=navigation-item><a class=navigation-link href=/about/>关于</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://youkale.github.io/posts/ngrok-compile-problem/>Ngrok 编译的坑</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2016-06-01T17:57:00Z>2016-06-01</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i></span></div></div></header><div><h3 id=ngrok-是用go语言实现的编译过程碰到不少坑>ngrok 是用go语言实现的，编译过程碰到不少坑
<a class=heading-link href=#ngrok-%e6%98%af%e7%94%a8go%e8%af%ad%e8%a8%80%e5%ae%9e%e7%8e%b0%e7%9a%84%e7%bc%96%e8%af%91%e8%bf%87%e7%a8%8b%e7%a2%b0%e5%88%b0%e4%b8%8d%e5%b0%91%e5%9d%91><i class="fa fa-link" aria-hidden=true></i></a></h3><blockquote><p>主要碰到的坑就是依赖错误，以及依赖的包被伟大的GFW给挡住了。
最好是用天朝外的VPS make release-server release-client</p></blockquote><p>修改日志src/ngrok/log/logger.go中的import部分改成</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>import <span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>  log <span style=color:#e6db74>&#34;github.com/alecthomas/log4go&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>)</span>
</span></span></code></pre></div><blockquote><p>其他的跟网上的差不多了。
下面就把依赖好的包打包发上来，以及编译的方法给大家说下：
这个包是已经包含好了依赖，拿到包后，确认你的环境，如果你要编译客户端需要go 1.6 否则编译会通不过</p></blockquote><ul><li>安装依赖</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>	sudo apt-get install build-essential golang mercurial git 
</span></span></code></pre></div><ul><li>解压</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> tar -zxv -f  ngrok.pkg.tar.gz 
</span></span></code></pre></div><ul><li>生成证书</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    openssl genrsa -out base.key <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>    openssl req -new -x509 -nodes -key base.key -days <span style=color:#ae81ff>10000</span> -subj <span style=color:#e6db74>&#34;/CN=ngrok.youkele.com&#34;</span> -out base.pem
</span></span><span style=display:flex><span>    openssl genrsa -out server.key <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>    openssl req -new -key server.key -subj <span style=color:#e6db74>&#34;/CN=ngrok.youkele.com&#34;</span> -out server.csr
</span></span><span style=display:flex><span>    openssl x509 -req -in server.csr -CA base.pem -CAkey base.key -CAcreateserial -days <span style=color:#ae81ff>10000</span> -out server.crt
</span></span><span style=display:flex><span>    cp base.pem assets/client/tls/ngrokroot.crt
</span></span></code></pre></div><ul><li>编译服务器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    make release-server
</span></span></code></pre></div><ul><li>编译客户端 (go >= 1.6)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#linux</span>
</span></span><span style=display:flex><span>make release-client
</span></span><span style=display:flex><span><span style=color:#75715e>#windows</span>
</span></span><span style=display:flex><span>GOOS<span style=color:#f92672>=</span>windows GOARCH<span style=color:#f92672>=</span>amd64 make release-client
</span></span><span style=display:flex><span><span style=color:#75715e>#mac</span>
</span></span><span style=display:flex><span>GOOS<span style=color:#f92672>=</span>darwin GOARCH<span style=color:#f92672>=</span>amd64 make release-client
</span></span></code></pre></div><blockquote><p>编译前如果make clean了，那记得把证书再copy一份cp base.pem assets/client/tls/ngrokroot.crt</p></blockquote><h3 id=运行>运行
<a class=heading-link href=#%e8%bf%90%e8%a1%8c><i class="fa fa-link" aria-hidden=true></i></a></h3><ul><li>服务器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> /usr/local/src/ngrok/bin/ngrokd -tlsKey<span style=color:#f92672>=</span>/usr/local/src/ngrok/server.key -tlsCrt<span style=color:#f92672>=</span>/usr/local/src/ngrok/server.crt -domain<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ngrok.youkele.com&#34;</span> -httpAddr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;:8090&#34;</span> -httpsAddr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;:4433&#34;</span>
</span></span></code></pre></div><ul><li>客户端</li></ul><p>ngrok.cfg</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    server_addr: <span style=color:#e6db74>&#34;ngrok.youkele.com:4443&#34;</span>
</span></span><span style=display:flex><span>    trust_host_root_certs: false
</span></span></code></pre></div><ul><li>客户端 启动</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>	./ngrok -config<span style=color:#f92672>=</span>./ngrok.cfg -subdomain<span style=color:#f92672>=</span>test <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>	./ngrok -h 可以看帮助
</span></span></code></pre></div><ul><li>配置nginx</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    listen 80;
</span></span><span style=display:flex><span>    server_name *.ngrok.xxx.xxx;
</span></span><span style=display:flex><span>    access_log /var/log/nginx/xxx.xxx.log;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        proxy_set_header X-Real-IP $remote_addr;
</span></span><span style=display:flex><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        proxy_set_header Host  $http_host:8090;
</span></span><span style=display:flex><span>        proxy_set_header X-Nginx-Proxy true;
</span></span><span style=display:flex><span>        proxy_set_header Connection <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        proxy_pass      http://127.0.0.1:8090;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2022
Youkale
·
<a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.f411a1043e37c7c14dfb03f4d94d60d9ee69cfa413b16d0fd4f28695babb82bb.js integrity="sha256-9BGhBD43x8FN+wP02U1g2e5pz6QTsW0P1PKGlbq7grs="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H9CHLFCJFP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-H9CHLFCJFP')</script></body></html>